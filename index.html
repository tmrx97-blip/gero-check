<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vital-Screening für Senioren v40.6</title>
    <style>
        :root { --blue: #007aff; --green: #34c759; --yellow: #ffcc00; --red: #ff3b30; --gray: #1c1e21; --light-bg: #f2f2f7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--light-bg); padding: 10px; color: #1c1e21; margin: 0; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 650px; margin: auto; }
        h2 { text-align: center; color: var(--blue); margin-bottom: 15px; font-weight: 800; font-size: 22px;}
        h3 { border-bottom: 2px solid #e5e5ea; padding-bottom: 5px; margin-top: 15px; font-size: 13px; color: #8e8e93; text-transform: uppercase; letter-spacing: 1px; }
        .group { margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        label { font-weight: 600; font-size: 14px; flex: 1; }
        input, select, textarea { padding: 10px; border: 1px solid #d1d1d6; border-radius: 10px; font-size: 15px; text-align: center; background: #fff; }
        input[type="number"], select { width: 85px; }
        .full-width { width: 100%; box-sizing: border-box; }
        .main-btn { width: 100%; padding: 10px; border: 2px solid #000; border-radius: 12px; font-size: 13px; font-weight: 700; background: transparent; cursor: pointer; text-align: center; margin-bottom: 5px; }
        .main-btn.selected { background: #e5e5ea; border-width: 3px; }
        .smart-box { display: none; padding: 4px; background: #fff; border-radius: 10px; margin-bottom: 8px; border: 1px dashed #000; }
        .smart-btn { display: inline-block; padding: 5px 12px; border: 1px solid #000; border-radius: 20px; font-size: 11px; margin: 3px; cursor: pointer; font-weight: 600; }
        .smart-btn.active { background: #000; color: #fff; }
        .res-container { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .res-box { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; border: 2px solid #000; font-size: 12px; color: #000; }
        #total-vitality { margin-top: 15px; padding: 15px; border-radius: 14px; text-align: center; font-weight: 900; font-size: 18px; border: 3px solid #000; color: #000;}
        #fall-risk-box { margin-top: 15px; padding: 15px; border-radius: 14px; text-align: center; font-weight: 900; font-size: 16px; border: 3px solid #000; color: #000; background: #fff; }
        .action-btn { width: 100%; padding: 18px; border: none; border-radius: 15px; font-size: 18px; font-weight: 700; cursor: pointer; margin-top: 20px; background: var(--blue); color: white; }
        .final-print-trigger { background: var(--gray) !important; margin-top: 40px; border: 4px solid var(--blue) !important; }
        
        #print-area { display: none; }
        
        @media print {
            @page { size: A4 portrait; margin: 15mm; }
            body { background: white !important; padding: 0 !important; margin: 0 !important; display: block !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .card, button, .group, h3, input, select, textarea { display: none !important; }
            #print-area { display: block !important; width: 100%; }
            .page { width: 100%; font-size: 11px; line-height: 1.4; color: #000; }
            h1 { border-bottom: 3px solid #000; padding-bottom: 8px; font-size: 18px; text-transform: uppercase; margin-bottom: 10px; margin-top: 0;}
            h2 { font-size: 13px; background: #f2f2f7 !important; padding: 6px; margin-top: 15px; margin-bottom: 10px; border-radius: 4px; border-left: 6px solid var(--blue) !important; page-break-after: avoid; }
            .vorbemerkung { font-size: 9.5px; font-style: italic; border: 1px solid #ccc; padding: 6px; margin-bottom: 15px; background: #fdfdfd; }
            .param-row { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; page-break-inside: avoid; display: block; width: 100%; }
            .param-title { font-weight: bold; font-size: 11.5px; }
            .val-red { color: #d32f2f !important; font-weight: 900; }
            .val-yellow { color: #b8860b !important; font-weight: bold; }
            .val-normal { color: #34c759 !important; font-weight: bold; }
            .param-analysis { margin-top: 4px; padding: 6px; background: #fff5f5 !important; border-left: 4px solid #d32f2f !important; font-size: 10px; -webkit-print-color-adjust: exact; }
            .param-warning { margin-top: 4px; padding: 6px; background: #fffdf5 !important; border-left: 4px solid #ffcc00 !important; font-size: 10px; -webkit-print-color-adjust: exact; }
            .param-ok { margin-top: 4px; font-size: 10px; color: #444; }
            .box-print { border: 1px solid #000; padding: 8px; border-radius: 6px; margin: 8px 0; background: #fff !important; page-break-inside: avoid; display: block; }
            .disclaimer { margin-top: 20px; border-top: 2px solid #000; padding-top: 8px; font-size: 8.5px; line-height: 1.3; text-align: justify; page-break-inside: avoid; }
            .signature-box { margin-top: 25px; page-break-inside: avoid; font-size: 11px; }
        }
    </style>
</head>
<body>
<div class="card">
    <h2>Vital-Screening v40.6</h2>
    
    <h3>1. Basis-Checkpoints</h3>
    <div class="group"><label>Patienten-ID</label><input type="text" id="p-name" placeholder="ID" style="width:120px;"></div>
    <div class="group"><label>Arzt-Handzeichen (Pflicht)</label><input type="text" id="arzt-hz" placeholder="Dr. ..." style="width:120px;"></div>
    <div class="group"><label>Geschlecht</label><select id="gender"><option value="w">Weiblich</option><option value="m">Männlich</option></select></div>
    <div class="group"><label>Gewicht (kg) / Größe (cm)</label><div><input type="number" id="weight" value="75"> / <input type="number" id="height" value="165"></div></div>
    <div class="group"><label>Medikamente ≥ 5 / Sturz im Vorjahr</label><div><select id="poly"><option value="0">Nein</option><option value="1">Ja</option></select> / <select id="fall"><option value="0">Nein</option><option value="1">Ja</option></select></div></div>

    <h3>2. Hämodynamik</h3>
    <div class="group"><label>RR syst / diast (mmHg)</label><div><input type="number" id="sys" value="130"> / <input type="number" id="dia" value="80"></div></div>
    <div class="group"><label>O2 SpO2 (%) / Puls (bpm)</label><div><input type="number" id="spo2" value="97"> / <input type="number" id="hr" value="68"></div></div>
    <div class="group"><label>Perfusions-Index (PI) / Orthostase</label><div><input type="number" id="pi" step="0.1" value="1.5"> / <select id="ortho"><option value="0">Nein</option><option value="1">Ja</option></select></div></div>

    <h3>3. Muskeln & Sicherheit</h3>
    <div class="group"><label>Aufstehen (s) / Handkraft (kg)</label><div><input type="number" id="chair" step="0.1" value="10.0"> / <input type="number" id="grip" value="28"></div></div>

    <h3>4. Kognition & Sinne</h3>
    <div class="group"><label>Kognition (Orientierung 0–30)</label><input type="number" id="demenz" value="28"></div>
    <div class="group"><label>Sehen (Pkt 0-4): R / L</label><div><input type="number" id="seeR" value="4"> / <input type="number" id="seeL" value="4"></div></div>
    <div class="group"><label>Hören (0-3 Pkt)</label><input type="number" id="hear" value="3"></div>

    <button class="action-btn" onclick="calculate()">Präventions-Auswertung starten</button>

    <div class="res-container">
        <div id="resH" class="res-box">H-STATUS</div>
        <div id="resM" class="res-box">M-STATUS</div>
        <div id="resC" class="res-box">C-STATUS</div>
        <div id="resS" class="res-box">S-STATUS</div>
    </div>
    
    <div id="fall-risk-box">STURZRISIKO-ORIENTIERUNG</div>
    <div id="total-vitality">VITAL-INDEX</div>

    <div id="shop-window" style="display:none; margin-top:25px;">
        <h3>Zusatzbeurteilung & Handlungsziele</h3>
        <div id="h-grid-box"><h3>Herz & Gefäße</h3><div id="h-grid"></div></div>
        <div id="m-grid-box"><h3>Muskeln & Sicherheit</h3><div id="m-grid"></div></div>
        <div id="v-grid-box"><h3>Resilienz & Vitalität</h3><div id="v-grid"></div></div>
        <textarea id="p-comment" rows="3" class="full-width" style="margin-top:15px;" placeholder="Ihre ärztlichen Notizen..."></textarea>
        <button class="action-btn final-print-trigger" onclick="prepareAndPrint()">BERICHT DRUCKEN</button>
    </div>
</div>

<div id="print-area">
    <div class="page">
        <h1>Präventives Vital-Screening – Auswertungsbericht</h1>
        <p id="pat-meta-top" style="border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 12px;"></p>
        <div class="vorbemerkung">
            <strong>Vorbemerkung:</strong> Dieses Dokument dient der strukturierten Präventionsberatung. Es stellt keine automatisierte Diagnose dar und ersetzt nicht die ärztliche Beurteilung. 
        </div>
        <h2>1. Parameterbezogene Analyse</h2>
        <div id="dynamic-parameters-list"></div>
        <h2>2. Orientierungswert Sturzrisiko</h2>
        <div class="box-print" style="border-left: 6px solid #ffcc00;" id="fall-risk-print"></div>
        <h2>3. Zusammenfassende Würdigung</h2>
        <div class="box-print" style="background: #f9f9fb !important; border-left: 6px solid var(--blue) !important;">
            <p id="auto-narrative-text" style="font-weight: bold;"></p>
            <div id="status-boxes" style="margin: 8px 0; font-size: 11px;"></div>
            <p id="manual-expert-text" style="font-style: italic; border-top: 1px solid #ddd; padding-top: 8px;"></p>
        </div>
        <h2>4. Besprochene Gesundheitsziele</h2>
        <div id="pat-goals-print"></div>
        <div class="disclaimer">
            <strong>Rechtlicher Hinweis:</strong> Die Empfehlungen wurden im Gespräch erläutert. Die eigenverantwortliche Umsetzung liegt beim Patienten. Dies entbindet nicht von der Pflicht, bei Veränderungen ärztlichen Rat einzuholen. Datenschutz: Verarbeitung nur lokal zur persönlichen Dokumentation.
        </div>
        <div class="signature-box">
            Datum: <span class="d-now"></span> | Arzt-Handzeichen: <span id="print-hz"></span> | Unterschrift: _________________________
        </div>
    </div>
</div>

<script>
const MMSE_NORM = 27, MMSE_GRENZ = 24, MMSE_ABKLAER = 18;
const OFFERS = {
    h: [{t:'Blutdruck (DASH-Kost)', s:['Kräuter statt Salz','5 Port. Obst/Gemüse']},{t:'Ausdauer', s:['150 Min Gehen/Wo','Schwimmen']}],
    m: [{t:'Kraft (Sarkopenie)', s:['3x10 Stuhlkante','Kraftzirkel']},{t:'Balance', s:['Einbeinstand (abgestützt)','Otago-Programm']}],
    v: [{t:'Gehirn-Fitness', s:['Lesekreis','Instrument/Spiele']},{t:'Trinken', s:['1.5L Wasser fix','Protokoll führen']}]
};
let globalResults = {};

function calculate() {
    const d = {
        pName: document.getElementById('p-name').value, arztHz: document.getElementById('arzt-hz').value,
        gender: document.getElementById('gender').value, w: +document.getElementById('weight').value,
        h: +document.getElementById('height').value/100, sys: +document.getElementById('sys').value,
        dia: +document.getElementById('dia').value, o2: +document.getElementById('spo2').value,
        hr: +document.getElementById('hr').value, pi: +document.getElementById('pi').value,
        ortho: +document.getElementById('ortho').value, ch: +document.getElementById('chair').value,
        gr: +document.getElementById('grip').value, poly: +document.getElementById('poly').value,
        fall: +document.getElementById('fall').value, dem: +document.getElementById('demenz').value,
        seeR: +document.getElementById('seeR').value, seeL: +document.getElementById('seeL').value,
        hear: +document.getElementById('hear').value
    };
    const bmi = d.w / (d.h * d.h);
    const gripT = (d.gender === 'm') ? 27 : 16;
    
    let sH = 0; if(d.sys>=120 && d.sys<=139) sH+=2; if(d.o2>=95) sH+=2; if(d.hr>=60 && d.hr<=85) sH+=2; if(d.pi>=1.4) sH+=2; if(d.ortho===1) sH-=3;
    let sM = 0; if(d.ch<=11) sM+=2; if(d.gr>=gripT) sM+=2; if(bmi>=22) sM+=2; if(d.fall===0) sM+=2;
    let sC = d.dem>=MMSE_NORM ? 3 : d.dem>=MMSE_GRENZ ? 2 : d.dem>=MMSE_ABKLAER ? 1 : 0;
    let sS = d.seeR + d.seeL + d.hear;

    let cH = sH>=8?'green':sH>=6?'yellow':'red', cM = sM>=6?'green':sM>=4?'yellow':'red', cC = sC===3?'green':sC===2?'yellow':'red', cS = sS>=8?'green':sS>=5?'yellow':'red';
    let total = sH+sM+sC+sS, cTot = total>=24?'green':total>=18?'yellow':'red';
    
    let sturzS = (d.fall*4)+(d.ortho*3)+(d.poly*2)+(cS==='red'?3:cS==='yellow'?1:0);

    const colors = { green: '#34c759', yellow: '#ffcc00', red: '#ff3b30' };
    const names = { '#34c759': 'Grün', '#ffcc00': 'Gelb', '#ff3b30': 'Rot' };

    document.getElementById('resH').style.background = colors[cH];
    document.getElementById('resM').style.background = colors[cM];
    document.getElementById('resC').style.background = colors[cC];
    document.getElementById('resS').style.background = colors[cS];
    document.getElementById('total-vitality').style.background = colors[cTot];
    document.getElementById('total-vitality').innerText = `VITAL-INDEX: ${total}/30 (${cTot.toUpperCase()})`;
    document.getElementById('fall-risk-box').innerText = `STURZRISIKO: ${sturzS}/12 Pkt`;

    globalResults = { d, bmi, gripT, cTot, total, sturzS, hexC: { cH: names[colors[cH]], cM: names[colors[cM]], cC: names[colors[cC]], cS: names[colors[cS]], cTot: names[colors[cTot]] } };
    document.getElementById('shop-window').style.display = 'block';
    renderGrid('h-grid', OFFERS.h); renderGrid('m-grid', OFFERS.m); renderGrid('v-grid', OFFERS.v);
}

function renderGrid(id, list) {
    const c = document.getElementById(id); c.innerHTML = "";
    list.forEach((it, i) => {
        const d = document.createElement('div');
        d.innerHTML = `<button class="main-btn" onclick="this.classList.toggle('selected'); toggleSmart('${id}-${i}')">${it.t}</button>
                       <div class="smart-box" id="smart-${id}-${i}">${it.s.map(s => `<span class="smart-btn" onclick="this.classList.toggle('active')">${s}</span>`).join('')}</div>`;
        c.appendChild(d);
    });
}
function toggleSmart(id) { const e = document.getElementById('smart-'+id); e.style.display = e.style.display==='block'?'none':'block'; }

function prepareAndPrint() {
    const { d, bmi, gripT, cTot, total, sturzS, hexC } = globalResults;
    if (!d.arztHz.trim()) return alert('Arzt-Handzeichen fehlt!');
    
    document.getElementById('pat-meta-top').innerText = `Pat-ID: ${d.pName || '---'} | Geschlecht: ${d.gender==='m'?'M':'W'} | Datum: ${new Date().toLocaleDateString()}`;
    document.getElementById('print-hz').innerText = d.arztHz;
    document.querySelectorAll('.d-now').forEach(e => e.innerText = new Date().toLocaleDateString());

    const params = [
        { t: 'BMI', v: bmi.toFixed(1), s: (bmi>=25||bmi<20)?'alert':'ok', txt: 'Einordnung des Gewichts im Verhältnis zur Körpergröße.' },
        { t: 'Blutdruck', v: `${d.sys}/${d.dia}`, s: (d.sys>140||d.dia>90)?'alert':'ok', txt: 'Status der hämodynamischen Belastung.' },
        { t: 'Handkraft', v: d.gr+' kg', s: (d.gr<gripT)?'alert':'ok', txt: 'Indikator für muskuläre Reserven.' },
        { t: 'Kognition', v: d.dem+' Pkt', s: d.dem>=MMSE_NORM?'ok':d.dem>=MMSE_GRENZ?'warn':'alert', txt: d.dem>=MMSE_NORM?'Unauffällig.':d.dem>=MMSE_GRENZ?'Grenzbereich – Hausarzt informieren.':'Hausarzt informieren.' }
    ];

    let html = "";
    params.forEach(p => {
        let vCl = p.s==='alert'?'val-red':p.s==='warn'?'val-yellow':'val-normal';
        let bCl = p.s==='alert'?'param-analysis':p.s==='warn'?'param-warning':'param-ok';
        html += `<div class="param-row"><span class="param-title">${p.t}:</span> <span class="${vCl}">${p.v}</span><div class="${bCl}">${p.txt}</div></div>`;
    });
    document.getElementById('dynamic-parameters-list').innerHTML = html;

    document.getElementById('fall-risk-print').innerHTML = `Orientierungswert: ${sturzS}/12 Pkt. Zusammensetzung aus Sturzhistorie, Orthostase, Polypharmazie und Sinnesleistung.`;
    document.getElementById('auto-narrative-text').innerText = (cTot==='green'?'Robustes Präventionsprofil.':cTot==='yellow'?'Gemischtes Bild mit Handlungsfeldern.':'Mehrere relevante Handlungsfelder identifiziert.');
    document.getElementById('status-boxes').innerHTML = `H:${hexC.cH} | M:${hexC.cM} | C:${hexC.cC} | S:${hexC.cS} <br><strong>VITAL-INDEX: ${total}/30</strong>`;
    document.getElementById('manual-expert-text').innerText = document.getElementById('p-comment').value || "Individuelle Beratung erfolgt.";

    let goals = ""; document.querySelectorAll('.smart-btn.active').forEach(b => goals += `<li>${b.innerText}</li>`);
    document.getElementById('pat-goals-print').innerHTML = goals ? `<ul>${goals}</ul>` : "Keine spezifischen Ziele markiert.";

    document.getElementById('print-area').style.display = 'block';
    setTimeout(() => { window.print(); document.getElementById('print-area').style.display = 'none'; }, 500);
}
</script>
</body>
</html>
